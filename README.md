# 한글챗 (Hangeul Chat)

![Image](https://github.com/user-attachments/assets/430cdd3d-f717-4d32-9eab-5137ae5b32f1)

## 1. 개요

### About

**한글 문서(HWP/HWPX) 기반 AI 채팅 서비스**

- 국내 공공기관과 기업에서 널리 사용되는 HWP/HWPX 문서를 AI와 대화하며 분석할 수 있는 서비스
- 문서를 업로드하면 AI가 자동으로 내용을 요약하고, 이후 문서 기반 Q&A 채팅이 가능
- HWP/HWPX 텍스트 추출 라이브러리(hwplib, hwpxlib)와 Spring AI를 결합하여 구현
- 실시간 스트리밍 응답으로 자연스러운 대화 경험 제공
- 다국어(한국어, 영어, 아랍어) 및 다크/라이트 테마 지원

### Tech Stack

```
┌─────────────────────────────────────────────────────────────────┐
│                          Frontend                               │
│  ┌───────────┐  ┌────────────┐  ┌────────────┐  ┌─────────────┐ │
│  │ Next.js 15│  │ React 19   │  │ TypeScript │  │Tailwind CSS │ │
│  └───────────┘  └────────────┘  └────────────┘  └─────────────┘ │
│  ┌────────────┐  ┌───────────┐  ┌────────────┐  ┌────────────┐  │
│  │  Zustand   │  │ next-intl │  │next-themes │  │   Sonner   │  │
│  └────────────┘  └───────────┘  └────────────┘  └────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼ REST API + SSE Streaming
┌─────────────────────────────────────────────────────────────────┐
│                          Backend                                │
│  ┌───────────┐  ┌────────────┐  ┌───────────┐  ┌─────────────┐  │
│  │  Java 21  │  │Spring Boot │  │ Spring AI │  │   WebFlux   │  │
│  │           │  │    3.5     │  │   1.0.1   │  │ (Reactive)  │  │
│  └───────────┘  └────────────┘  └───────────┘  └─────────────┘  │
│  ┌────────────────┐  ┌─────────────────────────────────────────┐│
│  │ hwplib/hwpxlib │  │        Spring Data JPA + Redis          ││
│  └────────────────┘  └─────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Infrastructure                            │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │  MySQL 8        │  │  Redis 7        │  │   Docker        │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  |
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 주요 기능

### 문서 업로드 및 AI 요약

- **드래그 앤 드롭** 또는 클릭으로 HWP/HWPX 파일 업로드
- 문서 업로드 시 **hwplib/hwpxlib**를 통해 텍스트 자동 추출
- **GPT API**를 활용한 문서 내용 자동 요약
- 실시간 **SSE(Server-Sent Events) 스트리밍**으로 타이핑 효과 제공

### 문서 기반 Q&A 채팅

- 업로드된 문서 내용을 기반으로 자유로운 질의응답 가능
- 대화 히스토리 유지로 맥락을 이해한 연속 대화 지원
- 친근한 구어체로 자연스러운 대화 경험 제공

### 사용자 경험

<img width="920" height="401" alt="Image" src="https://github.com/user-attachments/assets/b6cd0151-dc22-49c8-8c83-ae7dc6f48388" />

- **다크/라이트 테마**: IDE 스타일의 세련된 다크 테마와 밝은 라이트 테마 지원

<img width="920" height="401" alt="Image" src="https://github.com/user-attachments/assets/873fa60e-c43f-4984-8ccd-99657aab20db" />

- **다국어 지원**: 한국어, 영어, 아랍어 3개 언어 지원 (next-intl)
- **회원 관리**: 로그인/회원가입으로 대화 기록 영구 저장 <br>
- **사이드바**: 이전 채팅 스레드 목록 관리 (이름 변경, 삭제)

---

## 4. 겪은 문제

### 스레드와 채팅이 많을 때 렌더링 성능 문제 

<img width="818" height="451" alt="Image" src="https://github.com/user-attachments/assets/e9b35925-fffe-48c3-bcad-cf020338ff60" />


**문제**
- 스레드와 채팅이 많을 때 렌더링 성능이 저하되어 초기 데이터 로드, 테마 전환, 언어 전환 시 사용자 경험 저하 발생

**해결**
- 모든 스레드와 채팅을 DOM에 렌더링하여 발생하는 문제로 확인

```js
import React from 'react'
import { useThreadStore } from '@/store/dataStore';
import ListItem from './ListItem';
import { Virtuoso } from 'react-virtuoso';

const SidebarList = () => {
    const { threads } = useThreadStore();

    return (
        <div className="flex-1 min-h-0">
            <Virtuoso
                className='mt-2'
                style={{ height: '100%' }}
                data={threads}
                itemContent={(index, thread) => (
                    <div className="mb-1">
                        <ListItem 
                            key={thread.id} 
                            threadId={thread.id} 
                            fileName={thread.fileName}
                        />
                    </div>
                )}
            />
        </div>
    )
``` 

- react-virtuoso 라이브러리를 활용한 가상스크롤 적용
- 화면에 보이는 영역의 컴포넌트만 렌더링하도록 최적화
- 성능 개선 결과는 아래와 같음 (스레드 200개, 개별 스레드 당 챗이 200개 있는 경우 기준 테스트)

#### 테스트 결과

| 테스트 회차 | 적용 전 | 적용 후 | 개선율 |
|------------|---------|---------|--------|
| 1차 | 4.791200초 | 0.521800초 | 89.1% |
| 2차 | 4.153800초 | 0.717700초 | 82.7% |
| 3차 | 3.243800초 | 0.260400초 | 92.0% |
| 4차 | 5.549000초 | 0.429000초 | 92.3% |
| 5차 | 2.977400초 | 0.140400초 | 95.3% |

#### 성능 개선 요약

| 구분 | 적용 전 | 적용 후 | 개선 효과 |
|------|---------|---------|-----------|
| 평균 로드 시간 | 4.143040초 | 0.413860초 | **90.0% 개선** |
| 최소 로드 시간 | 2.977400초 | 0.140400초 | 95.3% 개선 |
| 최대 로드 시간 | 5.549000초 | 0.717700초 | 87.1% 개선 |

### 라이트 테마에서 스크롤 시 테마 깜빡임 문제

<img width="818" height="451" alt="Image" src="https://github.com/user-attachments/assets/f867bc24-3fe4-475b-912c-13caafaed822" />

**문제**
- react-virtuoso로 가상 스크롤 적용 이후 라이트 테마 상태에서 채팅 영역 스크롤시 새로 렌더링되는 Message 컴포넌트가 잠깐 다크 테마로 표시되었다가 라이트 테마로 전환되는 깜빡임 현상 발생

**해결**
- 모듈 레벨에서 테마를 캐싱, 새 컴포넌트 마운트 시 올바른 테마를 초기값으로 사용하도록 수정

### MySQL 파드 미준비로 인한 백엔드 파드 생성 실패 문제

**문제**
- Kubernetes에서 백엔드 파드를 띄울 때 MySQL 파드가 아직 생성되지 않았거나 준비되지 않은 상태에서 백엔드 파드가 시작되면서 간헐적으로 파드 생성이 실패함
- 백엔드 애플리케이션이 시작할 때 MySQL에 연결을 시도하지만 MySQL이 준비되지 않아 연결 실패로 파드 재시작 루프 발생

**해결**
- 백엔드 Deployment에 `initContainers`를 추가하여 MySQL 파드가 준비될 때까지 대기 처리

```yml
      initContainers:
        - name: wait-for-mysql
          image: busybox:1.35
          command: ['sh', '-c']
          args:
            - |
              until nc -z mysql-service 3306; do
                echo "Waiting for MySQL to be ready..."
                sleep 2
              done
              echo "MySQL is ready!"
```

- `initContainers`를 사용하여 MySQL 서비스(`mysql-service:3306`)가 응답할 때까지 주기적으로 헬스체크를 수행
- MySQL이 준비된 후에만 백엔드 컨테이너가 시작되도록 보장하여 파드 생성 실패 문제 해결

---

## 5. 아쉬운 점 및 추후 보완점

**테이블, 차트 등 구조화된 데이터 인식 개선 필요**
- 현재 한글 문서(.hwpx) 데이터 추출 시 `hwpxlib`의 `TextExtractor`를 사용 중이나, 테이블과 차트의 구조 정보가 정확히 추출되지 않아 AI가 컨텍스트를 정확히 파악하기 어려운 한계 존재
- 향후 개선 방향:
  - 커스텀 추출 유틸리티 구현을 통해 테이블, 차트 등의 데이터 유형을 명시적으로 태깅
  - 구조화된 메타데이터와 함께 추출하여 AI의 문서 이해도 및 답변 정확도 향상

**벡터 DB 기반 RAG 구현 보류**
- 당초 한글 문서 업로드 시 임베딩 기반 유사도 검색을 통해 관련 청크만 벡터 DB에 저장하고, 이를 활용한 RAG 방식의 채팅 구현을 계획했으나 다음 이슈로 인해 보류:
  1. **초기 업로드 성능 저하**: 문서 임베딩 처리 과정에서 발생하는 지연으로 사용자 경험 저하
  2. **할루시네이션 문제**: 청크 기반 컨텍스트 제공 시 AI가 불완전한 정보로 부정확한 답변 생성
- 현재는 문서 전체를 컨텍스트로 제공하는 방식을 사용 중이나, 이로 인한 토큰 소비량 증가 문제 존재. 차후 해결 방안을 모색할 필요가 있음.

---

## 6. 성과

### 기술적 성과

- **최신 기술 스택 활용**: Next.js 15 + React 19, Spring Boot 3.5 + Spring AI 1.0.1
- **실시간 스트리밍**: WebFlux + SSE를 활용한 타이핑 효과 구현
- **한글 문서 처리**: hwplib/hwpxlib 기반 HWP/HWPX 텍스트 추출 파이프라인 구축
- **컨테이너 인프라**: Docker Compose + Kubernetes 배포 환경 구성

### 사용자 경험 성과

- **직관적 UI/UX**: 드래그 앤 드롭 업로드, 실시간 채팅 인터페이스
- **다국어 지원**: 한국어, 영어, 아랍어 3개 언어 완벽 지원
- **테마 지원**: 다크/라이트 테마로 사용자 선호 반영

---

## 7. 실행 방법

### 사전 요구사항

- Node.js 20+
- Java 21+
- Docker & Docker Compose

```bash
# 전체 서비스 실행 (MySQL, Redis)
docker-compose up -d

# 프론트엔드 실행
cd frontend
yarn install
yarn dev

# 백엔드 실행 (새 터미널)
cd backend
./gradlew bootRun
``
